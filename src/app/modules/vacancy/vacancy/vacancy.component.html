<form [formGroup]="vacancyForm">

  <div class="">
    <div class="field">
      <label class="label">Nome</label>
      <div class="control">
        <input class="input" placeholder="Nome da vaga" name="name" type="text" formControlName="name" #name required
          autocomplete="off" [ngClass]="{'is-danger': isInvalid('name')}">
      </div>
      <p class="help is-danger" *ngIf="isInvalid('name')">Nome é inválido</p>
    </div>

    <div class="field">
      <label class="label">Descrição</label>
      <div class="control">
        <textarea class="textarea" placeholder="Descrição" name="description" type="text" formControlName="description"
          #description required autocomplete="off" [ngClass]="{'is-danger': isInvalid('description')}"
          rows="4"></textarea>
      </div>
      <p class="help is-danger" *ngIf="isInvalid('description')">Descrição é inválida</p>
    </div>

    <app-skill-edit [skills]="getSkills()" (changed)="changeSkills($event)" editable="false" yearsVisible="false">
    </app-skill-edit>

    <div class="mt-4">
      <button type="button" class="button is-link w-150" [disabled]="!vacancyForm.valid"
        (click)="save()">Salvar</button>
      <button type="button" class="button is-light is-pulled-right w-150"
        [routerLink]="['/vacancies']">Cancelar</button>
    </div>

    <app-error-messages [messages]="messages" title="Erro ao se cadastrar"></app-error-messages>
  </div>
</form>

<div class="card mt-4">
  <header class="card-header">
    <p class="card-header-title">
      Aplicações para essa vaga
    </p>
  </header>
  <div class="card-content">
    <table class="table is-striped is-hoverable is-fullwidth">
      <thead>
        <th>Candidato</th>
        <th>Status</th>
        <th>Enviado em</th>
        <th>Atualizado em</th>
        <th>Erro</th>
        <th></th>
      </thead>
      <tbody>
        <tr *ngFor="let application of vacancyApplications$ | async">
          <td>
            <a [routerLink]="['/candidates/', application.candidateId, 'candidate']"><strong>{{application.candidateName}}</strong></a>
          </td>
          <td>
            <span [ngStyle]="{'color': getStatusColor(application)}">
              {{application.status}}
            </span>
          </td>
          <td>
            <span>
              {{application.sent | date:'dd/MM/yyyy HH:mm'}}
            </span>
          </td>
          <td>
            <span>
              {{application.updated | date:'dd/MM/yyyy HH:mm'}}
            </span>
          </td>
          <td>
            <a (click)="toggleModal()">
              {{application.error | sliceKeepLastWord:20}}
            </a>
            <div class="modal" [ngClass]="{'is-active': showErrorModal}">
              <div class="modal-background"></div>
              <div class="modal-content">
                <div class="notification">
                  {{application.error}}
                </div>
              </div>
              <button class="modal-close is-large" aria-label="close" (click)="toggleModal()"></button>
            </div>
          </td>
          <td>
            <div *ngIf="canTryAgain(application)">
              <button class="button is-link is-pulled-right is-small" (click)="sendAgain(application)">Reenviar</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
